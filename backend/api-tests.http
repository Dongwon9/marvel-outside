### Variables
@baseUrl = http://localhost:3000
@contentType = application/json
@userId='adsfsdf'
@postId='asdfsadf'
@authorId='asdfsadf'
@followerId='asdfsadf'
@followingId='asdfsadf'
### Health Check
GET {{baseUrl}}

################################################################################
# User API Tests
################################################################################

### Get all users
GET {{baseUrl}}/users

### Get all users with pagination
GET {{baseUrl}}/users?skip=0&take=10

### Get all users with ordering
GET {{baseUrl}}/users?orderBy=name

### Get user by ID
# @name getUserById
GET {{baseUrl}}/users/{{userId}}

### Create a new user
# @name createUser
POST {{baseUrl}}/users
Content-Type: {{contentType}}

{
  "email": "different@gmail.com",
  "name": "testuser",
  "password": "password123"
}

### Create another user (for post tests)
# @name createAuthor
POST {{baseUrl}}/users
Content-Type: {{contentType}}

{
  "email": "author@example.com",
  "name": "authoruser",
  "password": "password123"
}

###Log In
# @name loginUser
POST {{baseUrl}}/auth/login
Content-Type: {{contentType}}

{
  "email": "different@gmail.com", 
  "password": "password123" 
}

### Update user (partial)
PUT {{baseUrl}}/users/{{userId}}
Content-Type: {{contentType}}

{
  "name": "updateduser"
}

### Update user (all fields)
PUT {{baseUrl}}/users/{{userId}}
Content-Type: {{contentType}}

{
  "email": "updated@example.com",
  "name": "completelyupdated",
  "password": "newpassword123"
}

### Delete user
DELETE {{baseUrl}}/users/{{userId}}

################################################################################
# Post API Tests
################################################################################

### Get all posts
GET {{baseUrl}}/posts

### Get all posts with pagination
GET {{baseUrl}}/posts?skip=0&take=10

### Get all posts with ordering
GET {{baseUrl}}/posts?orderBy=title

### Get post by ID
GET {{baseUrl}}/posts/ㅇㄴㄹㄴㅁㄹㄴㅁㄹ

### Create a new post
# @name createPost
POST {{baseUrl}}/posts
Content-Type: {{contentType}}

{
  "title": "My First Post",
  "content": "This is the content of my first post",
  "authorId": "{{authorId}}"
}

### Create a post without content
POST {{baseUrl}}/posts
Content-Type: {{contentType}}

{
  "title": "Post Without Content",
  "authorId": "{{authorId}}"
}

### Update post (partial)
PUT {{baseUrl}}/posts/{{postId}}
Content-Type: {{contentType}}

{
  "title": "Updated Post Title"
}

### Update post (publish)
PUT {{baseUrl}}/posts/{{postId}}
Content-Type: {{contentType}}

{
  "publishedAt": "2026-02-02T00:00:00Z"
}

### Update post (complete)
PUT {{baseUrl}}/posts/{{postId}}
Content-Type: {{contentType}}

{
  "title": "Completely Updated Post",
  "content": "This is completely new content",
  "publishedAt": "2026-02-02T00:00:00Z"
}

### Delete post
DELETE {{baseUrl}}/posts/{{postId}}

################################################################################
# Integration Test Flow
################################################################################

### 1. Create an author user
# @name flowCreateAuthor
POST {{baseUrl}}/users
Content-Type: {{contentType}}

{
  "email": "flow-author@example.com",
  "name": "flowauthor",
  "password": "password123"
}

### 2. Create a post with the author ID from step 1
@flowAuthorId = {{flowCreateAuthor.response.body.id}}
# @name flowCreatePost
POST {{baseUrl}}/posts
Content-Type: {{contentType}}

{
  "title": "Integration Test Post",
  "content": "This post was created in an integration test flow",
  "authorId": "{{flowAuthorId}}"
}

### 3. Get the created post
@flowPostId = {{flowCreatePost.response.body.id}}
GET {{baseUrl}}/posts/{{flowPostId}}

### 4. Update the post
PUT {{baseUrl}}/posts/{{flowPostId}}
Content-Type: {{contentType}}

{
  "publishedAt": "2026-02-02T00:00:00Z"
}

### 5. Delete the post
DELETE {{baseUrl}}/posts/{{flowPostId}}

### 6. Delete the author
DELETE {{baseUrl}}/users/{{flowAuthorId}}

################################################################################
# Follow API Tests
################################################################################

### Get followers of a user
GET {{baseUrl}}/follows/users/{{userId}}/followers

### Get followers with pagination
GET {{baseUrl}}/follows/users/{{userId}}/followers?skip=0&take=10

### Get following list of a user
GET {{baseUrl}}/follows/users/{{userId}}/following

### Get following with pagination
GET {{baseUrl}}/follows/users/{{userId}}/following?skip=0&take=10

### Get follow statistics
GET {{baseUrl}}/follows/users/{{userId}}/stats

### Check if user A follows user B
GET {{baseUrl}}/follows/users/{{userAId}}/is-following/{{userBId}}

### Follow a user
# @name followUser
POST {{baseUrl}}/follows/users/{{followerId}}/follow
Content-Type: {{contentType}}

{
  "followingId": "{{followingId}}"
}

### Unfollow a user
DELETE {{baseUrl}}/follows/users/{{followerId}}/follow/{{followingId}}

################################################################################
# Follow Integration Test Flow
################################################################################

### 1. Create user A
# @name flowCreateUserA
POST {{baseUrl}}/users
Content-Type: {{contentType}}

{
  "email": "alice@example.com",
  "name": "alice",
  "password": "password123"
}

### 2. Create user B
# @name flowCreateUserB
POST {{baseUrl}}/users
Content-Type: {{contentType}}

{
  "email": "bob@example.com",
  "name": "bob",
  "password": "password123"
}

### 3. Create user C
# @name flowCreateUserC
POST {{baseUrl}}/users
Content-Type: {{contentType}}

{
  "email": "charlie@example.com",
  "name": "charlie",
  "password": "password123"
}

### 4. User A follows User B
@userAId = {{flowCreateUserA.response.body.id}}
@userBId = {{flowCreateUserB.response.body.id}}
@userCId = {{flowCreateUserC.response.body.id}}

# @name flowFollowAtoB
POST {{baseUrl}}/follows/users/{{userAId}}/follow
Content-Type: {{contentType}}

{
  "followingId": "{{userBId}}"
}

### 5. User A follows User C
# @name flowFollowAtoC
POST {{baseUrl}}/follows/users/{{userAId}}/follow
Content-Type: {{contentType}}

{
  "followingId": "{{userCId}}"
}

### 6. User B follows User A
# @name flowFollowBtoA
POST {{baseUrl}}/follows/users/{{userBId}}/follow
Content-Type: {{contentType}}

{
  "followingId": "{{userAId}}"
}

### 7. Check User A's following list (should be 2: B and C)
GET {{baseUrl}}/follows/users/{{userAId}}/following

### 8. Check User A's followers (should be 1: B)
GET {{baseUrl}}/follows/users/{{userAId}}/followers

### 9. Check User B's followers (should be 1: A)
GET {{baseUrl}}/follows/users/{{userBId}}/followers

### 10. Get User A's follow stats
GET {{baseUrl}}/follows/users/{{userAId}}/stats

### 11. Check if A follows B (should be true)
GET {{baseUrl}}/follows/users/{{userAId}}/is-following/{{userBId}}

### 12. Check if B follows C (should be false)
GET {{baseUrl}}/follows/users/{{userBId}}/is-following/{{userCId}}

### 13. User A unfollows User C
DELETE {{baseUrl}}/follows/users/{{userAId}}/follow/{{userCId}}

### 14. Check User A's following list again (should be 1: B)
GET {{baseUrl}}/follows/users/{{userAId}}/following

### 15. Clean up - Delete users
DELETE {{baseUrl}}/users/{{userAId}}

###
DELETE {{baseUrl}}/users/{{userBId}}

###
DELETE {{baseUrl}}/users/{{userCId}}

################################################################################
# Comment API Tests
################################################################################

### Create a comment on a post
# @name createComment
POST {{baseUrl}}/posts/{{postId}}/comments
Content-Type: {{contentType}}
Authorization: Bearer {{loginUser.response.body.access_token}}

{
  "content": "This is a great post!"
}

### Get all comments for a post
GET {{baseUrl}}/posts/{{postId}}/comments

### Get my comment on a post
# @name getMyComment
GET {{baseUrl}}/posts/{{postId}}/comments/me
Authorization: Bearer {{loginUser.response.body.access_token}}

### Update my comment
PATCH {{baseUrl}}/posts/{{postId}}/comments
Content-Type: {{contentType}}
Authorization: Bearer {{loginUser.response.body.access_token}}

{
  "content": "This is an updated comment!"
}

### Delete my comment
DELETE {{baseUrl}}/posts/{{postId}}/comments
Authorization: Bearer {{loginUser.response.body.access_token}}

